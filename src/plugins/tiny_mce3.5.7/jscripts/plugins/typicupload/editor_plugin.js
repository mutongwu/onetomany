(function(){tinymce.create("tinymce.plugins.TYPicUpload",{init:function(b,c){var a=null;function d(h){if(h){var g="";for(var f=0,e=h.length;f<e;f++){if(tinymce.isWebKit){new Image().src=h[f]["mid"]}g+=b.dom.createHTML("img",{src:h[f]["mid"],alt:h[f]["name"]||"",style:"max-width:500px",border:0})}a&&b.selection.moveToBookmark(a);b.execCommand("mceInsertContent",false,g);a=null}}b.addCommand("tyPicUpload",function(){a=b.selection.getBookmark(1);var g=b.id+"_typicupload",f=jQuery("#"+g),e=jQuery("#"+b.id);TY.loader("TY.ui.photoV2",function(){TY.ui.photo.prototype.mceClosePlugin=function(){this.hide();tinymce.plugins.TYPicUpload.tyVar=null};tinymce.plugins.TYPicUpload.tyVar=new TY.ui.photo({wrapContainer:e,el:f,uploadPic:{callback:function(h){d(h)}},newSociPic:{callback:function(h){d(h)}},webPic:{callback:function(h){d(h)}},noPreview:true,app:"blog",picNum:50,top:25,left:-35})})});b.addButton("typicupload",{title:"插入图片",cmd:"tyPicUpload","class":"photo"})},getInfo:function(){return{longname:"tyPicUpload",author:"wushufeng",authorurl:"http://www.tianya.cn",infourl:"http://www.tianya.cn",version:"1.0"}}});tinymce.PluginManager.add("typicupload",tinymce.plugins.TYPicUpload)})();