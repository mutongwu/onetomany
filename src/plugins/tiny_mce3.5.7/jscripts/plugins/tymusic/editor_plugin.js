(function(){tinymce.create("tinymce.plugins.TYMusic",{init:function(b,c){var a=null;b.addCommand("tyMusic",function(){a=b.selection.getBookmark(1);var f=b.id+"_tymusic",e=jQuery("#"+f),d=jQuery("#"+b.id);TY.loader("TY.ui.musicboxV2",function(){function g(h,k){var j={type:k===null?"EmbeddedAudio":"flash",width:k===null?260:(k.width||403),height:k===null?39:(k.height||60),params:{src:h,allowscriptaccess:"always",quality:"high",wmode:"transparent",type:"application/x-shockwave-flash"},video:{sources:[]}};if(k){j.params.flashvars="autoStart=false&targetUrl="+k.url}var i=tinymce.util.JSON.serialize(j,"'");b.execCommand("mceInsertContent",false,b.dom.createHTML("img",{"data-mce-src":b.baseURI.source+"/themes/advanced/img/trans.gif",src:b.baseURI.source+"/themes/advanced/img/trans.gif","class":"mceItemMedia "+(k===null?"mceItemEmbeddedAudio":"mceItemFlash"),width:k===null?260:(k.width||403),height:k===null?39:(k.height||60),"data-mce-json":i}))}TY.ui.musicbox.prototype.musicSearchFn=function(h){a&&b.selection.moveToBookmark(a);g(h.attr("widget"),null);this._hide();a=null};TY.ui.musicbox.prototype.musicUrlFn=function(h){a&&b.selection.moveToBookmark(a);if(h.app==="xiami"){g(h.widget,null)}else{g(h.widget,h)}this._hide();a=null};TY.ui.musicbox.prototype.mceClosePlugin=function(){this._hide();tinymce.plugins.TYMusic.tyVar=null};tinymce.plugins.TYMusic.tyVar=new TY.ui.musicbox({el:e.closest("td"),showArea:d,top:6,left:0})})});b.addButton("tymusic",{title:"插入音乐",cmd:"tyMusic","class":"music"})},getInfo:function(){return{longname:"tyMusic",author:"wushufeng",authorurl:"http://www.tianya.cn",infourl:"http://www.tianya.cn",version:"1.0"}}});tinymce.PluginManager.add("tymusic",tinymce.plugins.TYMusic)})();